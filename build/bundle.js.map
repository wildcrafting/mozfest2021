{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/entities.js","src/index.js","src/search.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"bundle.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","var defaultMaterial = new THREE.MeshStandardMaterial({color: 0x331a00});\r\nvar radius = 3;\r\n\r\nAFRAME.registerComponent('card', {\r\n  schema: {\r\n    position: {default: {x: 0, y: 0, z:0}, type: 'vec3'},\r\n    index: {default: 0, type: 'number' }\r\n  },\r\n\r\n  init: function () {\r\n    var el = this.el;\r\n    var self = this;\r\n    // Create geometry.\r\n    this.geometry = new THREE.PlaneGeometry(.1, .2, 32)\r\n    this.material = new THREE.MeshStandardMaterial({color: 0xffffff, side: THREE.DoubleSide});\r\n\r\n    // Create mesh.\r\n    this.mesh = new THREE.Mesh(this.geometry);\r\n    el.setObject3D('mesh', this.mesh);\r\n    el.object3D.position.set(this.data.position.x +.005, this.data.position.y - .25, this.data.position.z);\r\n\r\n    // iNaturalist doesn't allow crossorigin = anonymous/CORS, so we can't use them as a texture\r\n    // https://stackoverflow.com/questions/34826748/issue-with-crossorigin-anonymous-failing-to-load-images\r\n    // https://hacks.mozilla.org/2011/11/using-cors-to-load-webgl-textures-from-cross-domain-images/\r\n    // https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#what_requests_use_cors\r\n    // if(observations[self.data.index].photos){\r\n    //   var schema = {src: observations[self.data.index].photos[0].url, softmode: true}\r\n    //   this.el.crossOrigin = 'anonymous';\r\n    //   this.el.setAttribute('asset-on-demand', schema)\r\n    // }\r\n\r\n    el.object3D.lookAt(0, 2, 0)\r\n    // this.el.object3D.rotation.y ;\r\n    el.addEventListener('mouseenter', function () {\r\n      el.object3D.scale.copy({x: 2.5, y: 2.5, z:2.5});\r\n    });\r\n    el.addEventListener('mouseleave', function () {\r\n      el.object3D.scale.copy({x: 1, y: 1, z:1});\r\n    });\r\n    this.el.addEventListener('click', function () {\r\n      displayObservationCard(self.data.index);\r\n      el.setAttribute('animation', 'property: position; to: 0 0 0');\r\n    });\r\n  }\r\n});\r\nAFRAME.registerComponent('trelis', {\r\n  schema: {\r\n    numArch: {type: 'number', default: 0}\r\n  },\r\n\r\n  init: function () {\r\n    const circleRadius = .005;\r\n    const group = new THREE.Group();\r\n    const extrudeSettings = { amount: radius+.5, bevelEnabled: false };\r\n    const rotationAmount = ((Math.PI * 2) / this.data.numArch);\r\n\r\n    for(var i = 0; i < this.data.numArch; i++){\r\n      var circleShape = new THREE.Shape()\r\n        .moveTo( 0, circleRadius )\r\n        .quadraticCurveTo( circleRadius, circleRadius, circleRadius, 0 )\r\n        .quadraticCurveTo( circleRadius, - circleRadius, 0, - circleRadius )\r\n        .quadraticCurveTo( - circleRadius, - circleRadius, - circleRadius, 0 )\r\n        .quadraticCurveTo( - circleRadius, circleRadius, 0, circleRadius );\r\n\r\n      var geometry = new THREE.ExtrudeGeometry( circleShape, extrudeSettings );\r\n      var mesh = new THREE.Mesh( geometry, defaultMaterial );\r\n\r\n      mesh.rotation.y = rotationAmount * i;\r\n      mesh.position.set(0, .01, 0);\r\n\r\n      if(i > 0){\r\n        var geometry = new THREE.TorusGeometry( ((radius/this.data.numArch) * i) + .5, 0.005, 8, 100);\r\n        var torus = new THREE.Mesh( geometry, defaultMaterial );\r\n        torus.rotation.x = Math.PI / 2;\r\n        torus.position.set(0, .01, 0);\r\n        group.add( torus );\r\n      }\r\n      group.add( mesh );\r\n\r\n    }\r\n    var geometry = new THREE.TorusGeometry( .6, 0.005, 8, this.data.numArch);\r\n    var torus = new THREE.Mesh( geometry, defaultMaterial );\r\n    torus.rotation.x = Math.PI / 2;\r\n    torus.position.set(0, 2.5, 0);\r\n    // group.add( torus );\r\n    this.el.setObject3D('mesh', group);\r\n  }\r\n});\r\nAFRAME.registerComponent('scale-on-mouseenter', {\r\n  schema: {\r\n    to: {default: {x: 2.5, y: 2.5, z:2.5}, type: 'vec3'}\r\n  },\r\n\r\n  init: function () {\r\n    var data = this.data;\r\n    var el = this.el;\r\n    this.el.addEventListener('click', function () {\r\n      el.object3D.scale.copy(data.to);\r\n    });\r\n  }\r\n});\r\nAFRAME.registerComponent('arch', {\r\n  schema: {\r\n    rotation: {type: 'number', default: 0},\r\n    cards: {type: 'array', default:[]}\r\n  },\r\n  init: function () {\r\n    var h = 2 + (.1 * Math.random());\r\n    const group2 = new THREE.Group();\r\n    const curve = new THREE.EllipseCurve(\r\n      0,  0,            // ax, aY\r\n      radius, radius,           // xRadius, yRadius\r\n      0,  Math.PI,  // aStartAngle, aEndAngle\r\n      false,            // aClockwise\r\n      Math.PI/2                // aRotation\r\n    );\r\n\r\n    var points = curve.getPoints( 250 );\r\n    var rootPoints = [];\r\n\r\n    for(var j = 0; j < 6; j++){\r\n      rootPoints.push([]);\r\n      var path = \"\";\r\n      for(var k = 0; k < points.length; k+=1){\r\n        var i = Math.floor(k);\r\n        if(i > 0){\r\n          path += \", \";\r\n        }\r\n\r\n        points[i].z = noise(i/20, j, (this.data.rotation*2)) + ((.1 * j) - (2.5 * .1)) + (Math.sin(((j*4*this.data.rotation) + i)/10)*.2);\r\n        // var x = points[i].x + noise(i/5, j, (this.data.rotation*2))/2\r\n        var x = points[i].x;\r\n\r\n        path += x  + \" \" + points[i].y + \" \" + points[i].z;\r\n        rootPoints[j].push({x: x, y:points[i].y , z: points[i].z});\r\n      }\r\n\r\n      var line = document.createElement('a-entity');\r\n      var sch = {lineWidth: 2, path: path, color: \"#331a00\", lineWidthStyler: \"1 - p + .5\"};\r\n\r\n      line.setAttribute('meshline',sch);\r\n      this.el.appendChild(line);\r\n\r\n    }\r\n    for(var i = 0; i < this.data.cards.length; i++){\r\n      // var randomPoint = points[Math.floor(Math.random() * 70) + 10];\r\n      var randomPoint = rootPoints[i%6][Math.floor((i/this.data.cards.length)*100) + 20];\r\n      var cardEl = document.createElement('a-entity');\r\n      var sch = {position: randomPoint, rotation: this.data.rotation, index: this.data.cards[i]};\r\n\r\n      cardEl.setAttribute('card', sch);\r\n      this.el.appendChild(cardEl);\r\n    }\r\n\r\n    this.el.setAttribute('geometry-merger', {preserveOriginal: false})\r\n    this.el.object3D.rotation.y = this.data.rotation;\r\n\r\n  },\r\n});\r\n","require('./entities.js')\r\nrequire('./search.js')\r\n\r\nvar inat_data = [\"species_guess\", \"place_guess\"]\r\nvar observations = [];\r\nvar basket = [];\r\n\r\nvar hideObservationCard = () => {$(\"#overlay-container\").animate({top:\"100vh\"});}\r\n\r\nvar displayObservationCard = (index) => {\r\n  $(\"#overlay-container\").animate({top:0});\r\n  basket.push(observations[index]);\r\n\r\n  for(var j = 0; j < inat_data.length; j++){\r\n    var tag = \"#\" + inat_data[j];\r\n    $(tag).html('');\r\n\r\n    if(inat_data[j] == \"photos\"){\r\n      for(var k = 0; k < observations[index][\"photos\"].length; k++){\r\n        $(tag).append('<img src=\"'+ observations[index][\"photos\"][k].url +'\"/>');\r\n      }\r\n    } else {\r\n      $(tag).html(observations[index][inat_data[j]]);\r\n    }\r\n  }\r\n}\r\n\r\nvar drawArches = () => {\r\n  var sceneEl = document.querySelector('a-scene');\r\n  var numArch = 10;\r\n  var rotationLvl = (Math.PI * 2) / numArch;\r\n\r\n  for(var i = 0; i < numArch; i++){\r\n    var d = [];\r\n    for(var j = i; j < observations.length; j += numArch){\r\n      d.push(j);\r\n    }\r\n    var schema = {rotation: rotationLvl * i, cards: d};\r\n    var entityEl = document.createElement('a-entity');\r\n\r\n    entityEl.setAttribute('arch', schema);\r\n    sceneEl.appendChild(entityEl);\r\n  }\r\n\r\n  var trelisEl = document.createElement('a-entity');\r\n  trelisEl.setAttribute('trelis', {numArch: 13});\r\n  sceneEl.appendChild(trelisEl);\r\n\r\n};\r\n\r\n\r\nfunction setup(){\r\n\r\n  $('#close,#overlay-container').on(\"click\", () => { hideObservationCard() })\r\n  $('#overlay').on(\"click\", (e) => { e.preventDefault(); return false; })\r\n  // sample data\r\n  // for(var k = 0; k < 500; k++){\r\n  //   observations.push({val: k});\r\n  // }\r\n\r\n  // real data\r\n  getData = airtableSearch();\r\n  getData.then(() => {\r\n    drawArches();\r\n    // shp(\"wwf_terr_ecos\").then(async (geojson) => {\r\n    //   // drawArches();\r\n    //   console.log(\"loaded\")\r\n    //   var turfPolygons = [];\r\n    //   for(var j = 0; j < observations.length; j++){\r\n    //     var pt = false;\r\n    //     if(observations[j].location){\r\n    //       pt = observations[j].location.split(\",\");\r\n    //       pt = [parseFloat(pt[0]), parseFloat(pt[1])]\r\n    //       pt = turf.point(pt);\r\n    //       console.log(pt)\r\n    //     } else if(observations[j].place_ids.length > 0){\r\n    //       // await new Promise( (resolve, reject) => {\r\n    //       //           var place = observations[j].place_ids[observations[j].place_ids.length-1];\r\n    //       //           console.log(place)\r\n    //       //           resolve();\r\n    //       //           // $.ajax({\r\n    //       //           //     url: \"https://api.inaturalist.org/v1/places/\" + place,\r\n    //       //           //     success: function(data) {\r\n    //       //           //       pt = data.results.location.split(\",\");\r\n    //       //           //       pt = [parseFloat(pt[0]), parseFloat(pt[1])]\r\n    //       //           //       pt = turf.point(pt);\r\n    //       //           //       resolve();\r\n    //       //           //     }\r\n    //       //           // });\r\n    //       //       });\r\n    //     }\r\n    //\r\n    //     if(pt){\r\n    //\r\n    //       for(var i = 0; i < geojson.features.length; i++){\r\n    //         if(!turfPolygons[i]){\r\n    //           turfPolygons.push(turf.polygon(geojson.features[i].geometry.coordinates[0]));\r\n    //         }\r\n    //         console.log(turfPolygons[i]);\r\n    //\r\n    //         var inside = turf.booleanPointInPolygon(pt, turfPolygons[i]);\r\n    //         if(inside){\r\n    //           console.log(observations[j].place_guess)\r\n    //           console.log(geojson.features[i].properties)\r\n    //           observations[j].bioregion = geojson.features[i].properties.ECO_NAME;\r\n    //         }\r\n    //\r\n    //       }\r\n    //     }\r\n    //   }\r\n    // });\r\n  });\r\n\r\n\r\n}\r\n\r\nsetup();\r\n","\nasync function search(){\n\n      var searchPromise = new Promise(async (resolve, reject) => {\n          $.ajax({\n              url: \"https://api.inaturalist.org/v1/observations?photos=true&project_id=97146&order=desc&order_by=created_at\",\n              success: function(data) {\n                observations = data.results;\n                console.log(data)\n                resolve();\n              }\n          });\n      });\n      return searchPromise;\n\n}\n\nasync function airtableSearch(){\n\n  var airtablePromise = new Promise((resolve, reject) => {\n    $.ajax({\n      url:\"https://api.airtable.com/v0/appIRHtaHUcrpPCvK/Observation?api_key=keyQSVeKTIgDnDvgT\",\n      success: function(data){\n        for(var i = 0; i < data.records.length; i++){\n          observations.push(data.records[i].fields);\n        }\n        resolve();\n      }\n    })\n  });\n  return airtablePromise;\n}\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvZW50aXRpZXMuanMiLCJzcmMvaW5kZXguanMiLCJzcmMvc2VhcmNoLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJ2YXIgZGVmYXVsdE1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hTdGFuZGFyZE1hdGVyaWFsKHtjb2xvcjogMHgzMzFhMDB9KTtcclxudmFyIHJhZGl1cyA9IDM7XHJcblxyXG5BRlJBTUUucmVnaXN0ZXJDb21wb25lbnQoJ2NhcmQnLCB7XHJcbiAgc2NoZW1hOiB7XHJcbiAgICBwb3NpdGlvbjoge2RlZmF1bHQ6IHt4OiAwLCB5OiAwLCB6OjB9LCB0eXBlOiAndmVjMyd9LFxyXG4gICAgaW5kZXg6IHtkZWZhdWx0OiAwLCB0eXBlOiAnbnVtYmVyJyB9XHJcbiAgfSxcclxuXHJcbiAgaW5pdDogZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGVsID0gdGhpcy5lbDtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIC8vIENyZWF0ZSBnZW9tZXRyeS5cclxuICAgIHRoaXMuZ2VvbWV0cnkgPSBuZXcgVEhSRUUuUGxhbmVHZW9tZXRyeSguMSwgLjIsIDMyKVxyXG4gICAgdGhpcy5tYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoU3RhbmRhcmRNYXRlcmlhbCh7Y29sb3I6IDB4ZmZmZmZmLCBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlfSk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIG1lc2guXHJcbiAgICB0aGlzLm1lc2ggPSBuZXcgVEhSRUUuTWVzaCh0aGlzLmdlb21ldHJ5KTtcclxuICAgIGVsLnNldE9iamVjdDNEKCdtZXNoJywgdGhpcy5tZXNoKTtcclxuICAgIGVsLm9iamVjdDNELnBvc2l0aW9uLnNldCh0aGlzLmRhdGEucG9zaXRpb24ueCArLjAwNSwgdGhpcy5kYXRhLnBvc2l0aW9uLnkgLSAuMjUsIHRoaXMuZGF0YS5wb3NpdGlvbi56KTtcclxuXHJcbiAgICAvLyBpTmF0dXJhbGlzdCBkb2Vzbid0IGFsbG93IGNyb3Nzb3JpZ2luID0gYW5vbnltb3VzL0NPUlMsIHNvIHdlIGNhbid0IHVzZSB0aGVtIGFzIGEgdGV4dHVyZVxyXG4gICAgLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzQ4MjY3NDgvaXNzdWUtd2l0aC1jcm9zc29yaWdpbi1hbm9ueW1vdXMtZmFpbGluZy10by1sb2FkLWltYWdlc1xyXG4gICAgLy8gaHR0cHM6Ly9oYWNrcy5tb3ppbGxhLm9yZy8yMDExLzExL3VzaW5nLWNvcnMtdG8tbG9hZC13ZWJnbC10ZXh0dXJlcy1mcm9tLWNyb3NzLWRvbWFpbi1pbWFnZXMvXHJcbiAgICAvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9IVFRQL0NPUlMjd2hhdF9yZXF1ZXN0c191c2VfY29yc1xyXG4gICAgLy8gaWYob2JzZXJ2YXRpb25zW3NlbGYuZGF0YS5pbmRleF0ucGhvdG9zKXtcclxuICAgIC8vICAgdmFyIHNjaGVtYSA9IHtzcmM6IG9ic2VydmF0aW9uc1tzZWxmLmRhdGEuaW5kZXhdLnBob3Rvc1swXS51cmwsIHNvZnRtb2RlOiB0cnVlfVxyXG4gICAgLy8gICB0aGlzLmVsLmNyb3NzT3JpZ2luID0gJ2Fub255bW91cyc7XHJcbiAgICAvLyAgIHRoaXMuZWwuc2V0QXR0cmlidXRlKCdhc3NldC1vbi1kZW1hbmQnLCBzY2hlbWEpXHJcbiAgICAvLyB9XHJcblxyXG4gICAgZWwub2JqZWN0M0QubG9va0F0KDAsIDIsIDApXHJcbiAgICAvLyB0aGlzLmVsLm9iamVjdDNELnJvdGF0aW9uLnkgO1xyXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgZWwub2JqZWN0M0Quc2NhbGUuY29weSh7eDogMi41LCB5OiAyLjUsIHo6Mi41fSk7XHJcbiAgICB9KTtcclxuICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGVsLm9iamVjdDNELnNjYWxlLmNvcHkoe3g6IDEsIHk6IDEsIHo6MX0pO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLmVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICBkaXNwbGF5T2JzZXJ2YXRpb25DYXJkKHNlbGYuZGF0YS5pbmRleCk7XHJcbiAgICAgIGVsLnNldEF0dHJpYnV0ZSgnYW5pbWF0aW9uJywgJ3Byb3BlcnR5OiBwb3NpdGlvbjsgdG86IDAgMCAwJyk7XHJcbiAgICB9KTtcclxuICB9XHJcbn0pO1xyXG5BRlJBTUUucmVnaXN0ZXJDb21wb25lbnQoJ3RyZWxpcycsIHtcclxuICBzY2hlbWE6IHtcclxuICAgIG51bUFyY2g6IHt0eXBlOiAnbnVtYmVyJywgZGVmYXVsdDogMH1cclxuICB9LFxyXG5cclxuICBpbml0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zdCBjaXJjbGVSYWRpdXMgPSAuMDA1O1xyXG4gICAgY29uc3QgZ3JvdXAgPSBuZXcgVEhSRUUuR3JvdXAoKTtcclxuICAgIGNvbnN0IGV4dHJ1ZGVTZXR0aW5ncyA9IHsgYW1vdW50OiByYWRpdXMrLjUsIGJldmVsRW5hYmxlZDogZmFsc2UgfTtcclxuICAgIGNvbnN0IHJvdGF0aW9uQW1vdW50ID0gKChNYXRoLlBJICogMikgLyB0aGlzLmRhdGEubnVtQXJjaCk7XHJcblxyXG4gICAgZm9yKHZhciBpID0gMDsgaSA8IHRoaXMuZGF0YS5udW1BcmNoOyBpKyspe1xyXG4gICAgICB2YXIgY2lyY2xlU2hhcGUgPSBuZXcgVEhSRUUuU2hhcGUoKVxyXG4gICAgICAgIC5tb3ZlVG8oIDAsIGNpcmNsZVJhZGl1cyApXHJcbiAgICAgICAgLnF1YWRyYXRpY0N1cnZlVG8oIGNpcmNsZVJhZGl1cywgY2lyY2xlUmFkaXVzLCBjaXJjbGVSYWRpdXMsIDAgKVxyXG4gICAgICAgIC5xdWFkcmF0aWNDdXJ2ZVRvKCBjaXJjbGVSYWRpdXMsIC0gY2lyY2xlUmFkaXVzLCAwLCAtIGNpcmNsZVJhZGl1cyApXHJcbiAgICAgICAgLnF1YWRyYXRpY0N1cnZlVG8oIC0gY2lyY2xlUmFkaXVzLCAtIGNpcmNsZVJhZGl1cywgLSBjaXJjbGVSYWRpdXMsIDAgKVxyXG4gICAgICAgIC5xdWFkcmF0aWNDdXJ2ZVRvKCAtIGNpcmNsZVJhZGl1cywgY2lyY2xlUmFkaXVzLCAwLCBjaXJjbGVSYWRpdXMgKTtcclxuXHJcbiAgICAgIHZhciBnZW9tZXRyeSA9IG5ldyBUSFJFRS5FeHRydWRlR2VvbWV0cnkoIGNpcmNsZVNoYXBlLCBleHRydWRlU2V0dGluZ3MgKTtcclxuICAgICAgdmFyIG1lc2ggPSBuZXcgVEhSRUUuTWVzaCggZ2VvbWV0cnksIGRlZmF1bHRNYXRlcmlhbCApO1xyXG5cclxuICAgICAgbWVzaC5yb3RhdGlvbi55ID0gcm90YXRpb25BbW91bnQgKiBpO1xyXG4gICAgICBtZXNoLnBvc2l0aW9uLnNldCgwLCAuMDEsIDApO1xyXG5cclxuICAgICAgaWYoaSA+IDApe1xyXG4gICAgICAgIHZhciBnZW9tZXRyeSA9IG5ldyBUSFJFRS5Ub3J1c0dlb21ldHJ5KCAoKHJhZGl1cy90aGlzLmRhdGEubnVtQXJjaCkgKiBpKSArIC41LCAwLjAwNSwgOCwgMTAwKTtcclxuICAgICAgICB2YXIgdG9ydXMgPSBuZXcgVEhSRUUuTWVzaCggZ2VvbWV0cnksIGRlZmF1bHRNYXRlcmlhbCApO1xyXG4gICAgICAgIHRvcnVzLnJvdGF0aW9uLnggPSBNYXRoLlBJIC8gMjtcclxuICAgICAgICB0b3J1cy5wb3NpdGlvbi5zZXQoMCwgLjAxLCAwKTtcclxuICAgICAgICBncm91cC5hZGQoIHRvcnVzICk7XHJcbiAgICAgIH1cclxuICAgICAgZ3JvdXAuYWRkKCBtZXNoICk7XHJcblxyXG4gICAgfVxyXG4gICAgdmFyIGdlb21ldHJ5ID0gbmV3IFRIUkVFLlRvcnVzR2VvbWV0cnkoIC42LCAwLjAwNSwgOCwgdGhpcy5kYXRhLm51bUFyY2gpO1xyXG4gICAgdmFyIHRvcnVzID0gbmV3IFRIUkVFLk1lc2goIGdlb21ldHJ5LCBkZWZhdWx0TWF0ZXJpYWwgKTtcclxuICAgIHRvcnVzLnJvdGF0aW9uLnggPSBNYXRoLlBJIC8gMjtcclxuICAgIHRvcnVzLnBvc2l0aW9uLnNldCgwLCAyLjUsIDApO1xyXG4gICAgLy8gZ3JvdXAuYWRkKCB0b3J1cyApO1xyXG4gICAgdGhpcy5lbC5zZXRPYmplY3QzRCgnbWVzaCcsIGdyb3VwKTtcclxuICB9XHJcbn0pO1xyXG5BRlJBTUUucmVnaXN0ZXJDb21wb25lbnQoJ3NjYWxlLW9uLW1vdXNlZW50ZXInLCB7XHJcbiAgc2NoZW1hOiB7XHJcbiAgICB0bzoge2RlZmF1bHQ6IHt4OiAyLjUsIHk6IDIuNSwgejoyLjV9LCB0eXBlOiAndmVjMyd9XHJcbiAgfSxcclxuXHJcbiAgaW5pdDogZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7XHJcbiAgICB2YXIgZWwgPSB0aGlzLmVsO1xyXG4gICAgdGhpcy5lbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgZWwub2JqZWN0M0Quc2NhbGUuY29weShkYXRhLnRvKTtcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcbkFGUkFNRS5yZWdpc3RlckNvbXBvbmVudCgnYXJjaCcsIHtcclxuICBzY2hlbWE6IHtcclxuICAgIHJvdGF0aW9uOiB7dHlwZTogJ251bWJlcicsIGRlZmF1bHQ6IDB9LFxyXG4gICAgY2FyZHM6IHt0eXBlOiAnYXJyYXknLCBkZWZhdWx0OltdfVxyXG4gIH0sXHJcbiAgaW5pdDogZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGggPSAyICsgKC4xICogTWF0aC5yYW5kb20oKSk7XHJcbiAgICBjb25zdCBncm91cDIgPSBuZXcgVEhSRUUuR3JvdXAoKTtcclxuICAgIGNvbnN0IGN1cnZlID0gbmV3IFRIUkVFLkVsbGlwc2VDdXJ2ZShcclxuICAgICAgMCwgIDAsICAgICAgICAgICAgLy8gYXgsIGFZXHJcbiAgICAgIHJhZGl1cywgcmFkaXVzLCAgICAgICAgICAgLy8geFJhZGl1cywgeVJhZGl1c1xyXG4gICAgICAwLCAgTWF0aC5QSSwgIC8vIGFTdGFydEFuZ2xlLCBhRW5kQW5nbGVcclxuICAgICAgZmFsc2UsICAgICAgICAgICAgLy8gYUNsb2Nrd2lzZVxyXG4gICAgICBNYXRoLlBJLzIgICAgICAgICAgICAgICAgLy8gYVJvdGF0aW9uXHJcbiAgICApO1xyXG5cclxuICAgIHZhciBwb2ludHMgPSBjdXJ2ZS5nZXRQb2ludHMoIDI1MCApO1xyXG4gICAgdmFyIHJvb3RQb2ludHMgPSBbXTtcclxuXHJcbiAgICBmb3IodmFyIGogPSAwOyBqIDwgNjsgaisrKXtcclxuICAgICAgcm9vdFBvaW50cy5wdXNoKFtdKTtcclxuICAgICAgdmFyIHBhdGggPSBcIlwiO1xyXG4gICAgICBmb3IodmFyIGsgPSAwOyBrIDwgcG9pbnRzLmxlbmd0aDsgays9MSl7XHJcbiAgICAgICAgdmFyIGkgPSBNYXRoLmZsb29yKGspO1xyXG4gICAgICAgIGlmKGkgPiAwKXtcclxuICAgICAgICAgIHBhdGggKz0gXCIsIFwiO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcG9pbnRzW2ldLnogPSBub2lzZShpLzIwLCBqLCAodGhpcy5kYXRhLnJvdGF0aW9uKjIpKSArICgoLjEgKiBqKSAtICgyLjUgKiAuMSkpICsgKE1hdGguc2luKCgoaio0KnRoaXMuZGF0YS5yb3RhdGlvbikgKyBpKS8xMCkqLjIpO1xyXG4gICAgICAgIC8vIHZhciB4ID0gcG9pbnRzW2ldLnggKyBub2lzZShpLzUsIGosICh0aGlzLmRhdGEucm90YXRpb24qMikpLzJcclxuICAgICAgICB2YXIgeCA9IHBvaW50c1tpXS54O1xyXG5cclxuICAgICAgICBwYXRoICs9IHggICsgXCIgXCIgKyBwb2ludHNbaV0ueSArIFwiIFwiICsgcG9pbnRzW2ldLno7XHJcbiAgICAgICAgcm9vdFBvaW50c1tqXS5wdXNoKHt4OiB4LCB5OnBvaW50c1tpXS55ICwgejogcG9pbnRzW2ldLnp9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdmFyIGxpbmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhLWVudGl0eScpO1xyXG4gICAgICB2YXIgc2NoID0ge2xpbmVXaWR0aDogMiwgcGF0aDogcGF0aCwgY29sb3I6IFwiIzMzMWEwMFwiLCBsaW5lV2lkdGhTdHlsZXI6IFwiMSAtIHAgKyAuNVwifTtcclxuXHJcbiAgICAgIGxpbmUuc2V0QXR0cmlidXRlKCdtZXNobGluZScsc2NoKTtcclxuICAgICAgdGhpcy5lbC5hcHBlbmRDaGlsZChsaW5lKTtcclxuXHJcbiAgICB9XHJcbiAgICBmb3IodmFyIGkgPSAwOyBpIDwgdGhpcy5kYXRhLmNhcmRzLmxlbmd0aDsgaSsrKXtcclxuICAgICAgLy8gdmFyIHJhbmRvbVBvaW50ID0gcG9pbnRzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDcwKSArIDEwXTtcclxuICAgICAgdmFyIHJhbmRvbVBvaW50ID0gcm9vdFBvaW50c1tpJTZdW01hdGguZmxvb3IoKGkvdGhpcy5kYXRhLmNhcmRzLmxlbmd0aCkqMTAwKSArIDIwXTtcclxuICAgICAgdmFyIGNhcmRFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EtZW50aXR5Jyk7XHJcbiAgICAgIHZhciBzY2ggPSB7cG9zaXRpb246IHJhbmRvbVBvaW50LCByb3RhdGlvbjogdGhpcy5kYXRhLnJvdGF0aW9uLCBpbmRleDogdGhpcy5kYXRhLmNhcmRzW2ldfTtcclxuXHJcbiAgICAgIGNhcmRFbC5zZXRBdHRyaWJ1dGUoJ2NhcmQnLCBzY2gpO1xyXG4gICAgICB0aGlzLmVsLmFwcGVuZENoaWxkKGNhcmRFbCk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5lbC5zZXRBdHRyaWJ1dGUoJ2dlb21ldHJ5LW1lcmdlcicsIHtwcmVzZXJ2ZU9yaWdpbmFsOiBmYWxzZX0pXHJcbiAgICB0aGlzLmVsLm9iamVjdDNELnJvdGF0aW9uLnkgPSB0aGlzLmRhdGEucm90YXRpb247XHJcblxyXG4gIH0sXHJcbn0pO1xyXG4iLCJyZXF1aXJlKCcuL2VudGl0aWVzLmpzJylcclxucmVxdWlyZSgnLi9zZWFyY2guanMnKVxyXG5cclxudmFyIGluYXRfZGF0YSA9IFtcInNwZWNpZXNfZ3Vlc3NcIiwgXCJwbGFjZV9ndWVzc1wiXVxyXG52YXIgb2JzZXJ2YXRpb25zID0gW107XHJcbnZhciBiYXNrZXQgPSBbXTtcclxuXHJcbnZhciBoaWRlT2JzZXJ2YXRpb25DYXJkID0gKCkgPT4geyQoXCIjb3ZlcmxheS1jb250YWluZXJcIikuYW5pbWF0ZSh7dG9wOlwiMTAwdmhcIn0pO31cclxuXHJcbnZhciBkaXNwbGF5T2JzZXJ2YXRpb25DYXJkID0gKGluZGV4KSA9PiB7XHJcbiAgJChcIiNvdmVybGF5LWNvbnRhaW5lclwiKS5hbmltYXRlKHt0b3A6MH0pO1xyXG4gIGJhc2tldC5wdXNoKG9ic2VydmF0aW9uc1tpbmRleF0pO1xyXG5cclxuICBmb3IodmFyIGogPSAwOyBqIDwgaW5hdF9kYXRhLmxlbmd0aDsgaisrKXtcclxuICAgIHZhciB0YWcgPSBcIiNcIiArIGluYXRfZGF0YVtqXTtcclxuICAgICQodGFnKS5odG1sKCcnKTtcclxuXHJcbiAgICBpZihpbmF0X2RhdGFbal0gPT0gXCJwaG90b3NcIil7XHJcbiAgICAgIGZvcih2YXIgayA9IDA7IGsgPCBvYnNlcnZhdGlvbnNbaW5kZXhdW1wicGhvdG9zXCJdLmxlbmd0aDsgaysrKXtcclxuICAgICAgICAkKHRhZykuYXBwZW5kKCc8aW1nIHNyYz1cIicrIG9ic2VydmF0aW9uc1tpbmRleF1bXCJwaG90b3NcIl1ba10udXJsICsnXCIvPicpO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAkKHRhZykuaHRtbChvYnNlcnZhdGlvbnNbaW5kZXhdW2luYXRfZGF0YVtqXV0pO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxudmFyIGRyYXdBcmNoZXMgPSAoKSA9PiB7XHJcbiAgdmFyIHNjZW5lRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdhLXNjZW5lJyk7XHJcbiAgdmFyIG51bUFyY2ggPSAxMDtcclxuICB2YXIgcm90YXRpb25MdmwgPSAoTWF0aC5QSSAqIDIpIC8gbnVtQXJjaDtcclxuXHJcbiAgZm9yKHZhciBpID0gMDsgaSA8IG51bUFyY2g7IGkrKyl7XHJcbiAgICB2YXIgZCA9IFtdO1xyXG4gICAgZm9yKHZhciBqID0gaTsgaiA8IG9ic2VydmF0aW9ucy5sZW5ndGg7IGogKz0gbnVtQXJjaCl7XHJcbiAgICAgIGQucHVzaChqKTtcclxuICAgIH1cclxuICAgIHZhciBzY2hlbWEgPSB7cm90YXRpb246IHJvdGF0aW9uTHZsICogaSwgY2FyZHM6IGR9O1xyXG4gICAgdmFyIGVudGl0eUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYS1lbnRpdHknKTtcclxuXHJcbiAgICBlbnRpdHlFbC5zZXRBdHRyaWJ1dGUoJ2FyY2gnLCBzY2hlbWEpO1xyXG4gICAgc2NlbmVFbC5hcHBlbmRDaGlsZChlbnRpdHlFbCk7XHJcbiAgfVxyXG5cclxuICB2YXIgdHJlbGlzRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhLWVudGl0eScpO1xyXG4gIHRyZWxpc0VsLnNldEF0dHJpYnV0ZSgndHJlbGlzJywge251bUFyY2g6IDEzfSk7XHJcbiAgc2NlbmVFbC5hcHBlbmRDaGlsZCh0cmVsaXNFbCk7XHJcblxyXG59O1xyXG5cclxuXHJcbmZ1bmN0aW9uIHNldHVwKCl7XHJcblxyXG4gICQoJyNjbG9zZSwjb3ZlcmxheS1jb250YWluZXInKS5vbihcImNsaWNrXCIsICgpID0+IHsgaGlkZU9ic2VydmF0aW9uQ2FyZCgpIH0pXHJcbiAgJCgnI292ZXJsYXknKS5vbihcImNsaWNrXCIsIChlKSA9PiB7IGUucHJldmVudERlZmF1bHQoKTsgcmV0dXJuIGZhbHNlOyB9KVxyXG4gIC8vIHNhbXBsZSBkYXRhXHJcbiAgLy8gZm9yKHZhciBrID0gMDsgayA8IDUwMDsgaysrKXtcclxuICAvLyAgIG9ic2VydmF0aW9ucy5wdXNoKHt2YWw6IGt9KTtcclxuICAvLyB9XHJcblxyXG4gIC8vIHJlYWwgZGF0YVxyXG4gIGdldERhdGEgPSBhaXJ0YWJsZVNlYXJjaCgpO1xyXG4gIGdldERhdGEudGhlbigoKSA9PiB7XHJcbiAgICBkcmF3QXJjaGVzKCk7XHJcbiAgICAvLyBzaHAoXCJ3d2ZfdGVycl9lY29zXCIpLnRoZW4oYXN5bmMgKGdlb2pzb24pID0+IHtcclxuICAgIC8vICAgLy8gZHJhd0FyY2hlcygpO1xyXG4gICAgLy8gICBjb25zb2xlLmxvZyhcImxvYWRlZFwiKVxyXG4gICAgLy8gICB2YXIgdHVyZlBvbHlnb25zID0gW107XHJcbiAgICAvLyAgIGZvcih2YXIgaiA9IDA7IGogPCBvYnNlcnZhdGlvbnMubGVuZ3RoOyBqKyspe1xyXG4gICAgLy8gICAgIHZhciBwdCA9IGZhbHNlO1xyXG4gICAgLy8gICAgIGlmKG9ic2VydmF0aW9uc1tqXS5sb2NhdGlvbil7XHJcbiAgICAvLyAgICAgICBwdCA9IG9ic2VydmF0aW9uc1tqXS5sb2NhdGlvbi5zcGxpdChcIixcIik7XHJcbiAgICAvLyAgICAgICBwdCA9IFtwYXJzZUZsb2F0KHB0WzBdKSwgcGFyc2VGbG9hdChwdFsxXSldXHJcbiAgICAvLyAgICAgICBwdCA9IHR1cmYucG9pbnQocHQpO1xyXG4gICAgLy8gICAgICAgY29uc29sZS5sb2cocHQpXHJcbiAgICAvLyAgICAgfSBlbHNlIGlmKG9ic2VydmF0aW9uc1tqXS5wbGFjZV9pZHMubGVuZ3RoID4gMCl7XHJcbiAgICAvLyAgICAgICAvLyBhd2FpdCBuZXcgUHJvbWlzZSggKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgLy8gICAgICAgLy8gICAgICAgICAgIHZhciBwbGFjZSA9IG9ic2VydmF0aW9uc1tqXS5wbGFjZV9pZHNbb2JzZXJ2YXRpb25zW2pdLnBsYWNlX2lkcy5sZW5ndGgtMV07XHJcbiAgICAvLyAgICAgICAvLyAgICAgICAgICAgY29uc29sZS5sb2cocGxhY2UpXHJcbiAgICAvLyAgICAgICAvLyAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgLy8gICAgICAgLy8gICAgICAgICAgIC8vICQuYWpheCh7XHJcbiAgICAvLyAgICAgICAvLyAgICAgICAgICAgLy8gICAgIHVybDogXCJodHRwczovL2FwaS5pbmF0dXJhbGlzdC5vcmcvdjEvcGxhY2VzL1wiICsgcGxhY2UsXHJcbiAgICAvLyAgICAgICAvLyAgICAgICAgICAgLy8gICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgIC8vICAgICAgIC8vICAgICAgICAgICAvLyAgICAgICBwdCA9IGRhdGEucmVzdWx0cy5sb2NhdGlvbi5zcGxpdChcIixcIik7XHJcbiAgICAvLyAgICAgICAvLyAgICAgICAgICAgLy8gICAgICAgcHQgPSBbcGFyc2VGbG9hdChwdFswXSksIHBhcnNlRmxvYXQocHRbMV0pXVxyXG4gICAgLy8gICAgICAgLy8gICAgICAgICAgIC8vICAgICAgIHB0ID0gdHVyZi5wb2ludChwdCk7XHJcbiAgICAvLyAgICAgICAvLyAgICAgICAgICAgLy8gICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgLy8gICAgICAgLy8gICAgICAgICAgIC8vICAgICB9XHJcbiAgICAvLyAgICAgICAvLyAgICAgICAgICAgLy8gfSk7XHJcbiAgICAvLyAgICAgICAvLyAgICAgICB9KTtcclxuICAgIC8vICAgICB9XHJcbiAgICAvL1xyXG4gICAgLy8gICAgIGlmKHB0KXtcclxuICAgIC8vXHJcbiAgICAvLyAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgZ2VvanNvbi5mZWF0dXJlcy5sZW5ndGg7IGkrKyl7XHJcbiAgICAvLyAgICAgICAgIGlmKCF0dXJmUG9seWdvbnNbaV0pe1xyXG4gICAgLy8gICAgICAgICAgIHR1cmZQb2x5Z29ucy5wdXNoKHR1cmYucG9seWdvbihnZW9qc29uLmZlYXR1cmVzW2ldLmdlb21ldHJ5LmNvb3JkaW5hdGVzWzBdKSk7XHJcbiAgICAvLyAgICAgICAgIH1cclxuICAgIC8vICAgICAgICAgY29uc29sZS5sb2codHVyZlBvbHlnb25zW2ldKTtcclxuICAgIC8vXHJcbiAgICAvLyAgICAgICAgIHZhciBpbnNpZGUgPSB0dXJmLmJvb2xlYW5Qb2ludEluUG9seWdvbihwdCwgdHVyZlBvbHlnb25zW2ldKTtcclxuICAgIC8vICAgICAgICAgaWYoaW5zaWRlKXtcclxuICAgIC8vICAgICAgICAgICBjb25zb2xlLmxvZyhvYnNlcnZhdGlvbnNbal0ucGxhY2VfZ3Vlc3MpXHJcbiAgICAvLyAgICAgICAgICAgY29uc29sZS5sb2coZ2VvanNvbi5mZWF0dXJlc1tpXS5wcm9wZXJ0aWVzKVxyXG4gICAgLy8gICAgICAgICAgIG9ic2VydmF0aW9uc1tqXS5iaW9yZWdpb24gPSBnZW9qc29uLmZlYXR1cmVzW2ldLnByb3BlcnRpZXMuRUNPX05BTUU7XHJcbiAgICAvLyAgICAgICAgIH1cclxuICAgIC8vXHJcbiAgICAvLyAgICAgICB9XHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gICB9XHJcbiAgICAvLyB9KTtcclxuICB9KTtcclxuXHJcblxyXG59XHJcblxyXG5zZXR1cCgpO1xyXG4iLCJcbmFzeW5jIGZ1bmN0aW9uIHNlYXJjaCgpe1xuXG4gICAgICB2YXIgc2VhcmNoUHJvbWlzZSA9IG5ldyBQcm9taXNlKGFzeW5jIChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICB1cmw6IFwiaHR0cHM6Ly9hcGkuaW5hdHVyYWxpc3Qub3JnL3YxL29ic2VydmF0aW9ucz9waG90b3M9dHJ1ZSZwcm9qZWN0X2lkPTk3MTQ2Jm9yZGVyPWRlc2Mmb3JkZXJfYnk9Y3JlYXRlZF9hdFwiLFxuICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgb2JzZXJ2YXRpb25zID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBzZWFyY2hQcm9taXNlO1xuXG59XG5cbmFzeW5jIGZ1bmN0aW9uIGFpcnRhYmxlU2VhcmNoKCl7XG5cbiAgdmFyIGFpcnRhYmxlUHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOlwiaHR0cHM6Ly9hcGkuYWlydGFibGUuY29tL3YwL2FwcElSSHRhSFVjcnBQQ3ZLL09ic2VydmF0aW9uP2FwaV9rZXk9a2V5UVNWZUtUSWdEbkR2Z1RcIixcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgZGF0YS5yZWNvcmRzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICBvYnNlcnZhdGlvbnMucHVzaChkYXRhLnJlY29yZHNbaV0uZmllbGRzKTtcbiAgICAgICAgfVxuICAgICAgICByZXNvbHZlKCk7XG4gICAgICB9XG4gICAgfSlcbiAgfSk7XG4gIHJldHVybiBhaXJ0YWJsZVByb21pc2U7XG59XG4iXX0="}